/*POCET_POSTAV_V_DOBRODRUZSTVI*/
/*V dobrodružství se musí zúčastnit alespoň dvě postavy*/

create or replace view POCET_POSTAV_V_DOBRODRUZSTVI as
select CISLO_DOBRODRUZSTVI , count(JMENO_POSTAVY) as POCET_POSTAV
from DOBRODRUZSTVI left join UCASTNI_SE using (CISLO_DOBRODRUZSTVI)
group by CISLO_DOBRODRUZSTVI
having count(JMENO_POSTAVY)<2;


/*DATUM_REGIS_SEZEN*/
/*Registrace hráče nemůže být později než sezení*/

create or replace view DATUM_REGIS_SEZEN as
select UCASTNI_SE.JMENO_POSTAVY, UCASTNI_SE.CISLO_DOBRODRUZSTVI, POSTAV_REG.LOGIN, POSTAV_REG.DATUM_REGISTRACE, SEZ_POSTAV.DATUM
from UCASTNI_SE left join 
(select JMENO_POSTAVY, LOGIN, DATUM_REGISTRACE
from POSTAVA join HRAC using (LOGIN)) POSTAV_REG
on UCASTNI_SE.JMENO_POSTAVY=POSTAV_REG.JMENO_POSTAVY
left join 
(select MISTO, DATUM, CISLO_DOBRODRUZSTVI, JMENO_POSTAVY
from SEZENI join UCASTNI_SE using (CISLO_DOBRODRUZSTVI)) SEZ_POSTAV
on POSTAV_REG.JMENO_POSTAVY=SEZ_POSTAV.JMENO_POSTAVY
where POSTAV_REG.DATUM_REGISTRACE>SEZ_POSTAV.DATUM;


/*ZISKANI_BEZ_SEZENI*/
/*Postava nemůže získat vybavení během události, jestli událost byla v dobrodružství, pro které ne bylo zaznamenáno sezení*/

create or replace view ZISKANI_BEZ_SEZENI as
select ZISKANI.NAZEV_VYBAVENI, ZISKANI.CISLO_DOBRODRUZSTVI, ZISKANI.CISLO_UDALOSTI, ZISKANI.JMENO_POSTAVY, DOBR_SEZ.MISTO, DOBR_SEZ.DATUM
from ZISKANI left join
(select DOBRODRUZSTVI.CISLO_DOBRODRUZSTVI, DOBRODRUZSTVI.NAZEV_DOBRODRUZSTVI, SEZENI.MISTO as MISTO, SEZENI.DATUM as DATUM
from DOBRODRUZSTVI left join SEZENI on DOBRODRUZSTVI.CISLO_DOBRODRUZSTVI=SEZENI.CISLO_DOBRODRUZSTVI) DOBR_SEZ
on ZISKANI.CISLO_DOBRODRUZSTVI=DOBR_SEZ.CISLO_DOBRODRUZSTVI
where DOBR_SEZ.MISTO is null;
